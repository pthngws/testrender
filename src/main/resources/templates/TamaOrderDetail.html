<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Chi tiết đơn hàng</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
  <!-- Tiêu đề -->
  <h1 class="text-center">Chi tiết đơn hàng</h1>

  <!-- Thông tin đơn hàng -->
  <div class="card mt-4">
    <div class="card-header">
      <h4>Thông tin đơn hàng</h4>
    </div>
    <div class="card-body">
      <p><strong>Mã đơn hàng:</strong> <span th:text="${order.orderId}">12345</span></p>
      <p><strong>Tên khách hàng:</strong> <span th:text="${order.customer.name}">OVP</span></p>
      <p><strong>Địa chỉ giao:</strong> <span th:text="${order.shippingAddress.other} + ' ' + ${order.shippingAddress.commune} + ', ' + ${order.shippingAddress.district} + ', ' + ${order.shippingAddress.province} + ', ' + ${order.shippingAddress.country}">179A</span></p>
      <p><strong>Ngày đặt:</strong> <span th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy')}">01/01/2024</span></p>
      <p th:if="${order.shippingStatus == 'Đã giao'}"><strong>Ngày nhận:</strong> <span th:text="${#temporals.format(order.receiveDate, 'dd/MM/yyyy')}">01/01/2024</span></p>
      <p><strong>Trạng thái:</strong> <span th:text="${order.shippingStatus}">Đang giao</span></p>
      <p><strong>Phương thức thanh toán:</strong> <span th:text="${order.payment.paymentMethod}">Thanh toán khi nhận hàng</span></p>
      <p><strong>Phương thức giao hàng:</strong> <span th:text="${order.shippingMethod}">Giao hàng tiêu chuẩn</span></p>
      <p><strong>Số điện thoại:</strong> <span th:text="${order.phoneNumber}">0123456789</span></p>
      <p><strong>Ghi chú:</strong> <span th:text="${order.note}">Không có ghi chú</span></p>
    </div>
  </div>

  <!-- Danh sách sản phẩm -->
  <div class="card mt-4">
    <div class="card-header">
      <h4>Danh sách sản phẩm</h4>
    </div>
    <div class="card-body">
      <table class="table table-bordered table-striped text-center">
        <thead class="table-dark">
        <tr>
          <th scope="col">STT</th>
          <th scope="col">Ảnh sản phẩm</th>
          <th scope="col">Tên sản phẩm</th>
          <th scope="col">Số lượng</th>
          <th scope="col">Giá</th>
          <th scope="col">Tổng tiền</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="lineItem, iterStat : ${order.listLineItems}">
          <td th:text="${iterStat.count}">1</td>
          <td>
            <img th:if="${lineItem.product.detail.images.size() > 0}"
                 th:src="@{${lineItem.product.detail.images[0].imageUrl}}"
                 alt="Ảnh sản phẩm" style="max-width: 100px; height: auto;">
            <span th:if="${lineItem.product.detail.images.size() == 0}">Không có ảnh</span>
          </td>
          <td th:text="${lineItem.product.name}">Laptop ABC</td>
          <td th:text="${lineItem.quantity}">2</td>
          <td th:text="${lineItem.product.price} + ' VND'">15,000,000 VND</td>
          <td th:text="${lineItem.quantity * lineItem.product.price} + ' VND'">30,000,000 VND</td>
        </tr>
        <tr th:if="${#lists.isEmpty(order.listLineItems)}">
          <td colspan="5" class="text-center">Không có sản phẩm nào!</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Hành động xác nhận hoặc hủy đơn hàng -->
  <div class="mt-3">
    <form th:action="@{/orders/{id}/confirm(id=${order.orderId})}" method="post" class="d-inline">
      <button type="submit" class="btn btn-success"
              onclick="return confirm('Bạn có chắc chắn muốn huỷ đơn hàng này?');">Xác nhận huỷ</button>
    </form>

    <form th:action="@{/orders/{id}/cancel(id=${order.orderId})}" method="post" class="d-inline">
      <button type="submit" class="btn btn-danger"
              onclick="return confirm('Bạn có chắc chắn muốn từ chối hủy đơn hàng này?');">Từ chối huỷ</button>
    </form>
  </div>

  <!-- Nút quay lại -->
  <div class="mt-4">
    <a th:href="@{/orders}" class="btn btn-secondary">Quay lại danh sách đơn hàng</a>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
