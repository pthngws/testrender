<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <!-- Thay thế phần header bằng fragment -->
  <th:block th:replace="~{fragments/head.html}"></th:block>
</head>

<body>
<div class="wrapper box-layout">

  <!-- header area start -->
  <th:block th:replace="~{fragments/header.html}"></th:block>
  <!-- header area end -->

  <!-- breadcrumb area start -->
  <th:block th:replace="~{fragments/breadcrumb.html}"></th:block>
  <!-- breadcrumb area end -->

  <!-- my account wrapper start -->
  <div class="my-account-wrapper">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <!-- My Account Page Start -->
          <div class="myaccount-page-wrapper">
            <!-- My Account Tab Menu Start -->
            <div class="row">
              <div class="col-lg-3 col-md-4">
                <div class="myaccount-tab-menu nav" role="tablist">
                  <a th:href="@{#address-edit}" data-toggle="tab"><i class="fa fa-map-marker"></i> Address</a>
                  <a th:href="@{#info-edit}" data-toggle="tab"><i class="fa fa-user"></i> Personal Information</a>
                </div>
              </div>
              <!-- My Account Tab Menu End -->

              <!-- My Account Tab Content Start -->
              <div class="col-lg-9 col-md-8">
                <div class="tab-content" id="myaccountContent">
                  <!-- Personal Information Tab Start -->
                  <div class="tab-pane fade show active" id="info-edit" role="tabpanel">
                    <div class="myaccount-content">
                      <h3>Personal Information</h3>
                      <form th:action="@{/user/update}" method="post">
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="name" class="required">Full Name</label>
                              <input type="text" id="name" name="name" class="form-control"
                                     th:value="${user.name}" placeholder="Enter your full name" />
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="email" class="required">Email</label>
                              <input type="email" id="email" name="email" class="form-control"
                                     th:value="${user.email}" placeholder="Enter your email" />
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="gender" class="required">Gender</label>
                              <select id="gender" name="gender" class="form-control">
                                <option value="Male" th:selected="${user.gender == 'Male'}">Male</option>
                                <option value="Female" th:selected="${user.gender == 'Female'}">Female</option>
                                <option value="Other" th:selected="${user.gender == 'Other'}">Other</option>
                              </select>
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="phone" class="required">Phone Number</label>
                              <input type="text" id="phone" name="phone" class="form-control"
                                     th:value="${user.phone}" placeholder="Enter your phone number" />
                            </div>
                          </div>
                        </div>
                        <div class="single-input-item">
                          <button type="submit" class="check-btn sqr-btn">Save Changes</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <!-- Personal Information Tab End -->

                  <!-- Address Details Tab Start -->
                  <div class="tab-pane fade show active" id="address-edit" role="tabpanel">
                    <div class="myaccount-content">
                      <h3>Address Details</h3>
                      <form th:action="@{/user/update}" method="post">
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="country" class="required">Country</label>
                              <input type="text" id="country" name="country" class="form-control"
                                     th:value="${user.address.country}" placeholder="Enter your country" />
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="province" class="required">Province/City</label>
                              <select id="province" name="province" class="form-control" onchange="updateDistricts()">
                                <option value="" disabled selected>Select Province/City</option>
                                <th:block th:each="entry : ${provincesAndDistricts}">
                                  <option th:value="${entry.key}" th:text="${entry.key}" th:selected="${entry.key == user.address.province}"></option>
                                </th:block>
                              </select>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="district" class="required">District</label>
                              <select id="district" name="district" class="form-control">
                                <option value="" disabled selected>Select District</option>
                                <th:block th:each="district : ${provincesAndDistricts[user.address.province]}">
                                  <option th:value="${district}" th:text="${district}" th:selected="${district == user.address.district}"></option>
                                </th:block>
                              </select>
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="commune" class="required">Commune</label>
                              <input type="text" id="commune" name="commune" class="form-control"
                                     th:value="${user.address.commune}" placeholder="Enter your commune" />
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-lg-12">
                            <div class="single-input-item">
                              <label for="other" class="required">Other Details</label>
                              <input type="text" id="other" name="other" class="form-control"
                                     th:value="${user.address.other}" placeholder="Enter other details" />
                            </div>
                          </div>
                        </div>
                        <div class="single-input-item">
                          <button type="submit" class="check-btn sqr-btn">Save Address</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <!-- Address Details Tab End -->

                </div>
              </div>
              <!-- My Account Tab Content End -->
            </div>
          </div>
          <!-- My Account Page End -->
        </div>
      </div>
    </div>
  </div>
  <!-- my account wrapper end -->

  <!-- brand area start -->
  <div class="brand-area pt-34 pb-30">
  </div>
  <!-- brand area end -->

  <!-- footer area start -->
  <th:block th:replace="~{fragments/footer.html}"></th:block>
  <!-- footer area end -->

</div>

<!-- Scroll to top start -->
<div class="scroll-top not-visible">
  <i class="fa fa-angle-up"></i>
</div>
<!-- Scroll to Top End -->

<script>
  const provincesAndDistricts = /*[[${provincesAndDistricts}]]*/ {}; // Nhúng dữ liệu từ backend vào JavaScript

  function updateDistricts() {
    const province = document.getElementById("province").value;
    const districtSelect = document.getElementById("district");

    // Xóa các quận/huyện hiện tại
    districtSelect.innerHTML = "<option value='' disabled selected>Select District</option>";

    // Thêm quận/huyện mới dựa theo tỉnh/thành phố đã chọn
    if (provincesAndDistricts[province]) {
      provincesAndDistricts[province].forEach(district => {
        const option = document.createElement("option");
        option.value = district;
        option.textContent = district;
        districtSelect.appendChild(option);
      });
    }
  }
</script>
</body>
</html>
